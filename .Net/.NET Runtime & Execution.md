# .NET Execution Flow

## 1. Raw C# Code (High-Level Language)

-   Written by developer in `.cs` files
-   Human-readable
-   Called **Source Code**
-   Example:

``` csharp
int Add(int a, int b)
{
    return a + b;
}
```

This is NOT executable by CPU.

------------------------------------------------------------------------

## 2. Build Process -- Conversion to IL

### Who is responsible?

-   **C# Compiler (Roslyn)**
-   Triggered by:
    -   `dotnet build`
    -   Visual Studio Build button

### What happens?

    C# Source Code
    → Converted to IL (Intermediate Language)
    → Stored inside .dll or .exe

### Output File Contains:

-   IL Code (CIL/MSIL)
-   Metadata (types, methods, references)
-   Manifest information

> IMPORTANT: `.dll` and `.exe` DO NOT contain raw C# source code.

------------------------------------------------------------------------

## 3. Where IL is Stored

After build:

-   Class Library → `.dll`
-   Console/Web App → `.exe` (which internally is also IL)

Both contain: - IL Code - Metadata

------------------------------------------------------------------------

## 4. What is IL (Intermediate Language)?

-   CPU-independent
-   OS-neutral
-   Not machine code
-   Not directly executable

It is a middle-layer language understood by CLR.

------------------------------------------------------------------------

## 5. Runtime -- Conversion to Native (Binary)

### Who is responsible?

-   **CLR (Common Language Runtime)**
-   Uses **JIT (Just-In-Time Compiler)**

### What happens at runtime?

    IL (from .dll/.exe)
    → CLR loads assembly
    → JIT converts IL → Native Machine Code (Binary)
    → CPU executes native code

This happens: - Method-by-method - First time method is called

------------------------------------------------------------------------

## 6. Why IL is Needed

If C# converted directly to machine code:

-   Windows x64 → one binary
-   Linux ARM → different binary
-   macOS → different binary

IL allows:

-   One build
-   Runs on multiple OS
-   CLR handles OS-specific conversion

This makes .NET **platform independent** (runtime dependent).

------------------------------------------------------------------------

## 7. Why Native (Binary) is Needed

CPU understands only:

-   Machine instructions (binary)

IL cannot run directly on CPU.

So final flow is:

    C# → IL → Native Binary → CPU Execution

------------------------------------------------------------------------

## 8. Role of CPU

CPU: - Executes only machine instructions - Does not understand C# -
Does not understand IL

Only understands: - Native Machine Code (Binary)

------------------------------------------------------------------------

## 9. Role of Visual Studio

Visual Studio:

-   Code editor
-   Error checking (design-time)
-   Calls compiler during build
-   Helps debug

It does NOT execute your code directly. Execution always happens via
CLR.

------------------------------------------------------------------------

## 10. .dll vs .exe in .NET

  Feature                  .dll   .exe
  ------------------------ ------ -----------
  Contains IL              Yes    Yes
  Has Entry Point (Main)   No     Yes
  Executable directly      No     Yes
  Used as Library          Yes    Sometimes

In .NET both are assemblies.

------------------------------------------------------------------------

## 11. CLR (Common Language Runtime)

CLR Responsibilities:

-   Loads assemblies (.dll/.exe)
-   Manages memory (Garbage Collector)
-   Handles exceptions
-   Provides security
-   Manages threads
-   Uses JIT to compile IL → Native

CLR is the execution engine of .NET.

------------------------------------------------------------------------

## 12. JIT (Just-In-Time Compiler)

JIT:

-   Converts IL → Native Machine Code
-   Runs at runtime
-   Compiles method when first used
-   Optimizes based on current CPU

------------------------------------------------------------------------

## 13. Full Flow Summary

    1. Developer writes C# Source Code
    2. Compiler converts C# → IL
    3. IL stored in .dll/.exe
    4. CLR loads assembly at runtime
    5. JIT converts IL → Native Machine Code
    6. CPU executes native instructions

------------------------------------------------------------------------

## 14. Important Terms

  Term             Meaning
  ---------------- -----------------------
  Source Code      Human-readable C#
  IL (CIL/MSIL)    Intermediate Language
  Assembly         .dll or .exe file
  Native Code      CPU Machine Code
  CLR              Runtime engine
  JIT              Converts IL → Native
  Managed Code     Runs under CLR
  Unmanaged Code   Runs directly on OS

------------------------------------------------------------------------

## 15. Key Memory Hooks

-   DLL does NOT contain raw C# code.
-   DLL contains IL.
-   IL is not binary.
-   CPU only executes native machine code.
-   CLR + JIT convert IL → Native.
-   Visual Studio is just a tool, not the runtime.
